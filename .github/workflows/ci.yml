name: VisionQA CI/CD Pipeline

# Ne zaman Ã§alÄ±ÅŸacak?
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

# Ä°ÅŸ akÄ±ÅŸlarÄ±
jobs:
  # ============================================
  # JOB 1: Temel Kontroller
  # ============================================
  basic-checks:
    name: Temel Kontroller
    runs-on: ubuntu-latest
    
    steps:
      - name: Kodu Ã§ek (Checkout)
        uses: actions/checkout@v4
      
      - name: README kontrolÃ¼
        run: |
          if [ ! -f "README.md" ]; then
            echo "âŒ README.md bulunamadÄ±!"
            exit 1
          fi
          echo "âœ… README.md var"
      
      - name: task.md kontrolÃ¼
        run: |
          if [ ! -f "task.md" ]; then
            echo "âŒ task.md bulunamadÄ±!"
            exit 1
          fi
          echo "âœ… task.md var"
      
      - name: .gitignore kontrolÃ¼
        run: |
          if [ ! -f ".gitignore" ]; then
            echo "âŒ .gitignore bulunamadÄ±!"
            exit 1
          fi
          echo "âœ… .gitignore var"
      
      - name: .env.example kontrolÃ¼
        run: |
          if [ ! -f ".env.example" ]; then
            echo "âŒ .env.example bulunamadÄ±!"
            exit 1
          fi
          echo "âœ… .env.example var"
      
      - name: Proje yapÄ±sÄ± kontrolÃ¼
        run: |
          echo "ğŸ“ Proje klasÃ¶rleri kontrol ediliyor..."
          for dir in backend frontend executors docs .github; do
            if [ ! -d "$dir" ]; then
              echo "âŒ $dir klasÃ¶rÃ¼ bulunamadÄ±!"
              exit 1
            fi
            echo "âœ… $dir klasÃ¶rÃ¼ var"
          done

  # ============================================
  # JOB 2: Docker Kontrolleri
  # ============================================
  docker-checks:
    name: Docker Kontrolleri
    runs-on: ubuntu-latest
    needs: basic-checks  # Temel kontroller baÅŸarÄ±lÄ± olursa Ã§alÄ±ÅŸ
    
    steps:
      - name: Kodu Ã§ek
        uses: actions/checkout@v4
      
      - name: docker-compose.yml kontrolÃ¼
        run: |
          if [ ! -f "docker-compose.yml" ]; then
            echo "âŒ docker-compose.yml bulunamadÄ±!"
            exit 1
          fi
          echo "âœ… docker-compose.yml var"
      
      - name: docker-compose syntax kontrolÃ¼
        run: |
          # Docker compose syntax doÄŸrulamasÄ±
          docker compose config > /dev/null
          if [ $? -eq 0 ]; then
            echo "âœ… docker-compose.yml syntax'Ä± doÄŸru"
          else
            echo "âŒ docker-compose.yml syntax hatasÄ±!"
            exit 1
          fi

  # ============================================
  # JOB 3: Python Backend (Ä°leride eklenecek)
  # ============================================
  # backend-tests:
  #   name: Backend Testleri
  #   runs-on: ubuntu-latest
  #   needs: docker-checks
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - name: Python kurulumu
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: '3.11'
  #     
  #     - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
  #       run: |
  #         cd backend
  #         pip install -r requirements.txt
  #     
  #     - name: Linting (ruff)
  #       run: |
  #         cd backend
  #         ruff check .
  #     
  #     - name: Type checking (mypy)
  #       run: |
  #         cd backend
  #         mypy .
  #     
  #     - name: Unit testler
  #       run: |
  #         cd backend
  #         pytest tests/ -v

  # ============================================
  # JOB 4: Frontend (Ä°leride eklenecek)
  # ============================================
  # frontend-tests:
  #   name: Frontend Testleri
  #   runs-on: ubuntu-latest
  #   needs: docker-checks
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - name: Node.js kurulumu
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: '20'
  #     
  #     - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
  #       run: |
  #         cd frontend
  #         npm ci
  #     
  #     - name: Linting (ESLint)
  #       run: |
  #         cd frontend
  #         npm run lint
  #     
  #     - name: Type checking
  #       run: |
  #         cd frontend
  #         npm run type-check
  #     
  #     - name: Unit testler
  #       run: |
  #         cd frontend
  #         npm test

  # ============================================
  # JOB 5: GÃ¼venlik TaramasÄ± (Ä°leride eklenecek)
  # ============================================
  # security-scan:
  #   name: GÃ¼venlik TaramasÄ±
  #   runs-on: ubuntu-latest
  #   needs: [backend-tests, frontend-tests]
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - name: Trivy gÃ¼venlik taramasÄ±
  #       uses: aquasecurity/trivy-action@master
  #       with:
  #         scan-type: 'fs'
  #         scan-ref: '.'
  #         format: 'sarif'
  #         output: 'trivy-results.sarif'
  #     
  #     - name: Bandit (Python gÃ¼venlik)
  #       run: |
  #         pip install bandit
  #         bandit -r backend/ -f json -o bandit-report.json

  # ============================================
  # JOB 6: BaÅŸarÄ± Bildirimi
  # ============================================
  success-notification:
    name: âœ… TÃ¼m Kontroller BaÅŸarÄ±lÄ±
    runs-on: ubuntu-latest
    needs: [basic-checks, docker-checks]
    
    steps:
      - name: BaÅŸarÄ± mesajÄ±
        run: |
          echo "ğŸ‰ Tebrikler! TÃ¼m CI/CD kontrolleri baÅŸarÄ±lÄ±!"
          echo "âœ… Temel kontroller: PASSED"
          echo "âœ… Docker kontrolleri: PASSED"
          echo ""
          echo "ğŸ“ Ä°leride eklenecek:"
          echo "   - Backend testleri (pytest)"
          echo "   - Frontend testleri (vitest)"
          echo "   - GÃ¼venlik taramasÄ± (Trivy)"
          echo "   - Docker build & push"
